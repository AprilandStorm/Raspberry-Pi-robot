# 用于控制 PCA9685 芯片的 C++ 驱动类
代码分为两个主要部分：
1. 类的声明（.hpp头文件）- 定义了类的成员变量、方法声明
2. 类的实现 - 实现了所有成员函数的具体逻辑

## I2C（Inter-Intergrated Circuit）
- I²C（Inter-Integrated Circuit）是一种用于短距离、低速、板级通信的同步串行总线，通过两条线（SDA + SCL）实现主设备与多个从设备之间的双向数据交换。
- I²C 通信原理
   1. 主从架构\
      (1) 主设备（Master）：发起通信（如树莓派）\
  (2) 从设备（Slave）：响应请求（如传感器、EEPROM）
   2. 通信流程
(1) 主设备发送起始信号（START）\
(2) 发送 从设备地址 + 读/写位（7位地址 + 1位 R/W）\
(3) 从设备应答（ACK）\
(4) 主设备发送 寄存器地址（可选）\
(5) 主设备读/写数据\
(6) 主设备发送 停止信号（STOP）
   3. 地址格式
(1) 7位地址 + 1位读写位; 例如：0x40 写 = 0x80，0x40 读 = 0x81

- I²C 的优点
  1. 简单	只需两根线
  2. 多设备共享	多个传感器共用总线
  3. 地址寻址	可区分多个相同型号设备
  4. 广泛支持	几乎所有传感器都支持 I²C
- I²C 的缺点
  1. 速度慢 不适合高速数据传输（如摄像头）
  2. 距离短 	一般不超过 1 米
  3. 总线冲突 多主模式下需仲裁

## 初始化
- ioctl() 是 Linux 的 I/O 控制系统调用（Input/Output Control）, 用于对设备文件进行非标准读写操作（比如配置设备、获取状态等）
```
int ioctl(int fd, unsigned long request, ...);
```
- I2C_SLAVE  是一个 ioctl 请求码（request code）, 定义在 <linux/i2c-dev.h> 头文件中, 含义：设置当前操作的 I²C 从设备地址. 注意：I2C_SLAVE 会修改内核中该文件描述符的状态，后续所有 read/write 都会自动发送到这个从设备。
- 扫描 I²C 设备地址：sudo i2cdetect -y 1
- write() 成功时返回实际写入的字节数

## 设置PWM频率
- PCA9685 默认频率约为 200Hz，但很多应用（如舵机）需要 50Hz，所以必须通过修改预分频寄存器来调整。
- PCA9685 的内部时钟是 25MHz
- 分频公式：prescale = (25000000 / (4096 * freq)) - 1\
  公式来源（来自 PCA9685 数据手册）：PWM 频率 = 时钟源 / (4096 × (PRE_SCALE + 1))\
      时钟源（Clock Source）：PCA9685 内部振荡器，默认 25 MHz（25,000,000 Hz）\
      4096：PCA9685 的 PWM 分辨率（12 位，即 0-4095）\
      PRE_SCALE：预分频寄存器值（8 位，0-255）
- 4096 是因为 PCA9685 是 12 位 PWM 控制器（2^12=4096）
- MODE1 寄存器的作用（PCA9685 手册定义）

| 位 | 名称 | 作用 |
|----|----|----|
| 7 | Restart | 重启模式（只读） |
| 6 | ExtClk | 外部时钟使能 |
| 5 | Auto-Increment | 地址自动递增（重要！） |
| 4 | Sleep | 睡眠模式（低功耗）|
| 3 | Sub1 | 响应子地址 1 |
| 2 | Sub2 | 响应子地址 2 |
| 1 | Sub3 | 响应子地址 3 |
| 0 | AllCall | 响应“所有调用”地址 |

- 根据 PCA9685 数据手册规定：只有在 SLEEP 模式下，才能修改 PRE_SCALE 寄存器（地址 0xFE）

## 设置指定通道的 PWM 开启（on）和关闭（off）时刻，从而控制占空比

| 寄存器地址 | 名称 | 作用 |
|----|----|----|
| 0x06 + 4*ch | LEDn_ON_L | on 的低 8 位 |
| 0x07 + 4*ch | LEDn_ON_H | on 的高 4 位（低 4 位固定为 0） |
| 0x08 + 4*ch | LEDn_OFF_L | off 的低 8 位 |
| 0x09 + 4*ch | LEDn_OFF_H	 | off 的高 4 位（低 4 位固定为 0） | 

## 舵机控制
- 舵机（Servo Motor）控制原理：
  1. 使用 PWM 信号 控制; 频率：通常为 50Hz（周期 20ms）; 脉冲宽度（Pulse Width）：决定舵机角度(500μs → 0°; 1500μs → 90°（中位）; 2500μs → 180°), 不同舵机范围可能略有差异（如 400~2400μs），但 500~2500μs 是通用标准。
  2. PCA9685 将一个周期分为 4096 个时间片。每个时间片的时长 = periodUs / 4096; 要产生 pulseUs 的高电平，需要开启 pulseUs / (periodUs/4096) 个时间片; 即：off = pulseUs * 4096 / periodUs
- 角度范围：0° ~ 180°; 脉冲范围：500μs ~ 2500μs; 每度对应的脉冲增量 = (2500 - 500) / 180 = 2000 / 180 ≈ 11.11 μs/度
